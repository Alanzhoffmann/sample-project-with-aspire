@page "/products/{id:guid}"
@using AspireSampleApp.Contracts.DTOs
@attribute [StreamRendering(true)]

@inject ProductApiClient ProductApi

<PageTitle>@(product?.Name ?? "Product")</PageTitle>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/products">Products</a></li>
        <li class="breadcrumb-item active" aria-current="page">@(product?.Name ?? "Detail")</li>
    </ol>
</nav>

@if (notFound)
{
    <h1>Product not found</h1>
    <p>The product you are looking for does not exist.</p>
}
else if (product == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <h1>@product.Name</h1>

    @if (!product.HasThirdPartyData)
    {
        <div class="alert alert-warning" role="alert">
            <strong>Inventory data unavailable.</strong> The third-party service did not return pricing or stock information for this product.
        </div>
    }

    <dl class="row">
        <dt class="col-sm-3">ID</dt>
        <dd class="col-sm-9">@product.Id</dd>

        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9">@(product.Description ?? "-")</dd>

        <dt class="col-sm-3">Price</dt>
        <dd class="col-sm-9">@(product.HasThirdPartyData ? product.Price.ToString("C") : "N/A")</dd>

        <dt class="col-sm-3">Stock</dt>
        <dd class="col-sm-9">@(product.HasThirdPartyData ? product.Stock.ToString() : "N/A")</dd>
    </dl>
}

@code {
    [Parameter]
    public Guid Id { get; set; }

    private ProductDto? product;
    private bool notFound;

    protected override async Task OnInitializedAsync()
    {
        product = await ProductApi.GetProductByIdAsync(Id);
        notFound = product is null;
    }
}
